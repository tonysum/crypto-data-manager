# 跨交易所数据管理系统开发提示词 (Prompt Template)

如果你需要为新的交易所（如 OKX, Bybit 等）开发一套类似的稳健型数据管理系统，可以直接将以下提示词复制给 AI 助手。

---

## 🚀 开发提示词 (Copy & Paste)

**Role**: 你是一个经验丰富的量化交易系统架构师，擅长构建高可用、防封禁的加密货币数据管理系统。

**Context**: 我需要为 **[在此处填入交易所名称]** 开发一套 K 线数据管理系统。该系统需参照“稳健串行架构”进行设计，核心目标是确保数据 24/7 完整无缺失，且绝对不触发交易所的 IP 封禁。

**Technical Requirements (The Robust Blueprint)**:
1.  **分层架构**: 
    - **接入层**: 封装 SDK，实现带“指数退避”机制的重试装饰器，支持代理配置。
    - **逻辑层**: 实现“差量更新”逻辑（先查库再补全）；支持大跨度时间范围的自动切片下载。
    - **存储层**: 使用 PostgreSQL，必须包含主键冲突（UniqueViolation）的自愈机制（遇到重复数据时自动降级为逐条插入并跳过）。
2.  **稳健调度机制**: 
    - **串行队列**: 使用 `asyncio.Queue` 实现任务串行化，禁止并行启动多个周期的下载任务。
    - **强制限速**: 严格遵守交易所 API 权重限制，设置合理的 `request_delay`（建议起始 1.0s）和 `batch_delay`。
    - **封禁检测**: 自动捕获 429 或封禁错误，一旦触发必须进入 10 分钟以上的静默休眠期。
3.  **开发栈**: Python (FastAPI + SQLAlchemy), PostgreSQL, UV 包管理。

**Task Deliverables**:
1.  设计 `[交易所名称]_client.py` 核心封装类。
2.  编写 `download_klines.py` 实现差量补全逻辑。
3.  编写基于异步队列的 `scheduler_klines.py`。
4.  提供对应的数据库初始化脚本（确保 trade_date 为唯一索引）。

**Constraint**: 请优先考虑“稳健性”而非“并发速度”。请在代码中详细注释如何规避该交易所特定的频率限制（Rate Limit）。

---
*Generated by AI Assistant on 2026-01-28*
